<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8"/>
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>Exploring Mexican Culinary Heritage ‚Äì Interactive Activity</title>
  <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&family=Crimson+Text:ital,wght@0,400;0,600;1,400&display=swap" rel="stylesheet">

  <style>
    :root{
      --brand: #4f46e5;
      --brand-light: #6366f1;
      --accent: #7c3aed;
      --accent-light: #8b5cf6;
      --success: #ef7c8e;
      --success-light: #ffe8e3;
      --warning: #d97706;
      --ink: #0f172a;
      --text-muted: #64748b;
      --text-light: #94a3b8;
      --bg-primary: #ffffff;
      --bg-secondary: #f8fafc;
      --bg-tertiary: #f1f5f9;
      --border-light: #e2e8f0;
      --border-medium: #cbd5e1;
      --shadow-sm: 0 1px 2px 0 rgb(0 0 0 / 0.05);
      --shadow-md: 0 4px 6px -1px rgb(0 0 0 / 0.1), 0 2px 4px -2px rgb(0 0 0 / 0.1);
      --shadow-lg: 0 10px 15px -3px rgb(0 0 0 / 0.1), 0 4px 6px -4px rgb(0 0 0 / 0.1);
      --shadow-xl: 0 20px 25px -5px rgb(0 0 0 / 0.1), 0 8px 10px -6px rgb(0 0 0 / 0.1);
      --radius-sm: 8px;
      --radius-md: 12px;
      --radius-lg: 16px;
      --transition-fast: 0.15s ease-out;
      --transition-medium: 0.25s ease-out;
      --transition-slow: 0.35s cubic-bezier(0.4, 0, 0.2, 1);
    }

    * {
      box-sizing: border-box;
    }

    html, body {
      margin: 0; 
      padding: 0;
      font-family: 'Inter', -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
      font-size: 16px; 
      line-height: 1.6;
      color: var(--ink);
      background: linear-gradient(135deg, #f8fafc 0%, #e2e8f0 100%);
      scroll-behavior: smooth;
    }

    /* Typography improvements */
    h1, h2, h3 {
      font-family: 'Crimson Text', serif;
      font-weight: 600;
      line-height: 1.2;
      margin: 0;
    }

    h1 { font-size: 2.5rem; color: var(--brand); }
    h2 { font-size: 1.875rem; color: var(--ink); margin-bottom: 1rem; }
    h3 { font-size: 1.5rem; color: var(--brand); margin-bottom: 0.75rem; }

    p { margin: 0 0 1rem; }
    
    .text-sm { font-size: 0.875rem; color: var(--text-muted); }
    .text-xs { font-size: 0.75rem; color: var(--text-light); }

    a { 
      color: var(--accent); 
      text-decoration: none;
      transition: color var(--transition-fast);
    }
    a:hover { color: var(--brand); }

    /* Layout improvements */
    .container {
      max-width: 1200px;
      margin: 0 auto;
      padding: 2rem 1.5rem;
    }

    .section {
      margin-bottom: 3rem;
    }

    .card {
      background: var(--bg-primary);
      border: 1px solid var(--border-light);
      border-radius: var(--radius-lg);
      padding: 2rem;
      box-shadow: var(--shadow-md);
      transition: box-shadow var(--transition-medium);
    }

    .card:hover {
      box-shadow: var(--shadow-lg);
    }

    /* Enhanced header */
    .header {
      background: linear-gradient(135deg, var(--bg-primary) 0%, var(--bg-secondary) 100%);
      border: 2px solid var(--border-light);
      border-left: 6px solid var(--brand);
      border-radius: var(--radius-lg);
      padding: 2.5rem;
      box-shadow: var(--shadow-xl);
      margin-bottom: 3rem;
      text-align: center;
    }

    .header h1 {
      margin-bottom: 1rem;
    }

    .header-links {
      display: flex;
      justify-content: center;
      gap: 1rem;
      margin-top: 1.5rem;
      flex-wrap: wrap;
    }

    .header-link {
      display: inline-flex;
      align-items: center;
      gap: 0.5rem;
      padding: 0.75rem 1.25rem;
      background: var(--bg-primary);
      border: 1px solid var(--border-light);
      border-radius: var(--radius-md);
      font-weight: 500;
      transition: all var(--transition-medium);
      box-shadow: var(--shadow-sm);
    }

    .header-link:hover {
      transform: translateY(-2px);
      box-shadow: var(--shadow-md);
      border-color: var(--brand);
    }

    /* Enhanced flip cards - FIXED VERSION */
    .flip-grid {
      display: grid;
      grid-template-columns: repeat(3, 1fr);
      gap: 1.5rem;
      margin-top: 2rem;
      max-width: 100%;
    }

    @media (max-width: 1024px) {
      .flip-grid {
        grid-template-columns: repeat(2, 1fr);
        gap: 1.25rem;
      }
    }

    @media (max-width: 768px) {
      .flip-grid {
        grid-template-columns: 1fr;
        gap: 1rem;
      }
    }

    .flip-card {
      perspective: 1200px;
      height: 500px;
      cursor: pointer;
      transition: transform var(--transition-medium);
      width: 100%;
    }

    .flip-card:hover {
      transform: scale(1.02);
    }

    .flip-card:focus {
      outline: 3px solid var(--brand);
      outline-offset: 4px;
    }

    .flip-inner {
      position: relative;
      width: 100%;
      height: 100%;
      transform-style: preserve-3d;
      transition: transform 0.8s cubic-bezier(0.175, 0.885, 0.32, 1.275);
    }

    .flip-card.is-flipped .flip-inner {
      transform: rotateY(180deg);
    }

    .flip-front, .flip-back {
      position: absolute;
      inset: 0;
      backface-visibility: hidden;
      border-radius: var(--radius-lg);
      border: 2px solid var(--border-light);
      background: var(--bg-primary);
      box-shadow: var(--shadow-lg);
      padding: 1.5rem;
      display: flex;
      flex-direction: column;
      gap: 0.75rem;
      overflow-y: auto;
      font-size: 0.9rem;
    }

    .flip-front {
      border-top: 6px solid var(--brand);
    }

    .flip-back {
      border-top: 6px solid var(--accent);
      transform: rotateY(180deg);
    }

    .flip-badge {
      align-self: flex-start;
      background: linear-gradient(135deg, var(--brand) 0%, var(--brand-light) 100%);
      color: white;
      padding: 0.5rem 1rem;
      border-radius: 999px;
      font-size: 0.875rem;
      font-weight: 600;
      box-shadow: var(--shadow-md);
    }

    .translation-btn {
      align-self: flex-start;
      background: var(--bg-secondary);
      border: 1px solid var(--border-medium);
      padding: 0.5rem 1rem;
      border-radius: var(--radius-md);
      font-size: 0.8rem;
      font-weight: 500;
      cursor: pointer;
      transition: all var(--transition-medium);
      box-shadow: var(--shadow-sm);
    }

    .translation-btn:hover {
      background: var(--brand);
      color: white;
      transform: translateY(-1px);
      box-shadow: var(--shadow-md);
    }

    .translation-btn:active {
      transform: translateY(0);
    }

    .translation-btn.active {
      background: var(--brand);
      color: white;
    }

    .quote {
      font-family: 'Crimson Text', serif;
      font-size: 0.95rem;
      line-height: 1.5;
      font-style: italic;
      color: var(--ink);
      background: linear-gradient(135deg, #e0e7ff 0%, #ddd6fe 100%);
      padding: 1rem;
      border-radius: var(--radius-md);
      border: 2px solid var(--brand);
      margin: 0.5rem 0;
    }

    .attribution {
      font-size: 0.75rem;
      color: var(--text-muted);
      padding: 0.75rem;
      background: var(--bg-secondary);
      border-radius: var(--radius-sm);
      border: 1px solid var(--border-light);
      margin-top: auto;
    }

    .translation {
      display: none;
      font-style: italic;
      color: var(--text-muted);
      background: var(--success-light);
      padding: 1rem;
      border-radius: var(--radius-sm);
      border-left: 4px solid var(--success);
      font-size: 0.85rem;
      margin: 0.5rem 0;
      animation: fadeIn var(--transition-medium);
    }

    @keyframes fadeIn {
      from { opacity: 0; transform: translateY(-10px); }
      to { opacity: 1; transform: translateY(0); }
    }

    .flip-hint {
      margin-top: auto;
      text-align: center;
      color: var(--text-light);
      font-size: 0.8rem;
      padding: 0.75rem;
      background: var(--bg-tertiary);
      border-radius: var(--radius-sm);
      animation: pulse 2s ease-in-out infinite;
    }

    @keyframes pulse {
      0%, 100% { opacity: 0.6; }
      50% { opacity: 1; }
    }

    .research-topic h3 {
      display: flex;
      align-items: center;
      gap: 0.5rem;
      margin-bottom: 1rem;
      font-size: 1.2rem;
    }

    .research-topic ul {
      margin: 0 0 0.75rem 0;
      padding-left: 1.25rem;
    }

    .research-topic li {
      margin-bottom: 0.5rem;
      color: var(--text-muted);
      font-size: 0.85rem;
      line-height: 1.4;
    }

    .research-links {
      background: var(--bg-tertiary);
      padding: 0.75rem;
      border-radius: var(--radius-md);
      max-height: 180px;
      overflow-y: auto;
      flex: 1;
    }

    .research-links strong {
      display: block;
      margin-bottom: 0.5rem;
      font-size: 0.9rem;
    }

    .research-links ul {
      margin: 0;
      padding: 0;
      list-style: none;
    }

    .research-links li {
      margin-bottom: 0.5rem;
    }

    .research-links a {
      display: block;
      padding: 0.5rem;
      background: var(--bg-primary);
      border: 1px solid var(--border-light);
      border-radius: var(--radius-sm);
      transition: all var(--transition-medium);
      box-shadow: var(--shadow-sm);
      font-size: 0.8rem;
    }

    .research-links a:hover {
      background: var(--brand);
      color: white;
      transform: translateX(4px);
      box-shadow: var(--shadow-md);
    }

    /* Enhanced notes section */
    .notes-textarea {
      width: 100%;
      min-height: 200px;
      border: 2px solid var(--border-light);
      border-radius: var(--radius-md);
      padding: 1.5rem;
      font-family: inherit;
      font-size: 1rem;
      line-height: 1.6;
      resize: vertical;
      transition: border-color var(--transition-medium);
      background: var(--success-light);
    }

    .notes-textarea:focus {
      outline: none;
      border-color: var(--success);
      background: var(--bg-primary);
      box-shadow: 0 0 0 3px rgb(239 124 142 / 0.1);
    }

    .notes-status {
      display: inline-flex;
      align-items: center;
      gap: 0.5rem;
      margin-top: 0.75rem;
      padding: 0.5rem 1rem;
      background: var(--success);
      color: white;
      border-radius: var(--radius-sm);
      font-size: 0.875rem;
      font-weight: 500;
      opacity: 0;
      transition: opacity var(--transition-medium);
    }

    .notes-status.show {
      opacity: 1;
    }

    /* Cultural note enhancement */
    .cultural-note {
      background: linear-gradient(135deg, #ffe8e3 0%, #f1f5f9 100%);
      border-left: 6px solid var(--success);
      border-radius: var(--radius-lg);
      padding: 2rem;
      margin: 2rem 0;
      box-shadow: var(--shadow-lg);
    }

    .cultural-note h3 {
      display: flex;
      align-items: center;
      gap: 0.75rem;
      margin-bottom: 1.5rem;
    }

    .references-toggle {
      background: var(--success-light);
      border: 2px solid var(--success);
      color: var(--ink);
      padding: 0.75rem 1.25rem;
      border-radius: var(--radius-md);
      cursor: pointer;
      font-weight: 500;
      margin-top: 1rem;
      transition: all var(--transition-medium);
      display: inline-flex;
      align-items: center;
      gap: 0.5rem;
    }

    .references-toggle:hover {
      background: var(--success);
      color: white;
      transform: translateY(-1px);
      box-shadow: var(--shadow-md);
    }

    .references-content {
      display: none;
      margin-top: 1rem;
      padding: 1.5rem;
      background: rgba(255, 255, 255, 0.8);
      border-radius: var(--radius-sm);
      border: 1px solid var(--success);
      animation: fadeIn var(--transition-medium);
    }

    .references-content.show {
      display: block;
    }

    /* Enhanced poster studio */
    .toolbar {
      display: flex;
      flex-wrap: wrap;
      gap: 1rem;
      align-items: center;
      margin-bottom: 1.5rem;
      padding: 1.5rem;
      background: var(--bg-secondary);
      border-radius: var(--radius-md);
      border: 1px solid var(--border-light);
    }

    .toolbar-group {
      display: flex;
      gap: 0.75rem;
      align-items: center;
      padding: 0.75rem 1rem;
      background: var(--bg-primary);
      border: 1px solid var(--border-light);
      border-radius: var(--radius-md);
      box-shadow: var(--shadow-sm);
    }

    .toolbar-group label {
      font-weight: 500;
      color: var(--text-muted);
      font-size: 0.875rem;
    }

    .btn {
      appearance: none;
      border: 1px solid var(--border-medium);
      background: var(--bg-primary);
      padding: 0.75rem 1.25rem;
      border-radius: var(--radius-md);
      cursor: pointer;
      font-weight: 500;
      transition: all var(--transition-medium);
      box-shadow: var(--shadow-sm);
      display: inline-flex;
      align-items: center;
      gap: 0.5rem;
    }

    .btn:hover {
      background: var(--bg-tertiary);
      transform: translateY(-1px);
      box-shadow: var(--shadow-md);
    }

    .btn.active {
      background: var(--brand);
      color: white;
      border-color: var(--brand);
    }

    .btn-primary {
      background: linear-gradient(135deg, var(--brand) 0%, var(--accent) 100%);
      color: white;
      border: none;
      font-weight: 600;
      box-shadow: var(--shadow-md);
    }

    .btn-primary:hover {
      transform: translateY(-2px);
      box-shadow: var(--shadow-lg);
    }

    .canvas-wrapper {
      border-radius: var(--radius-lg);
      overflow: hidden;
      background: var(--bg-primary);
      box-shadow: var(--shadow-lg);
      border: 2px solid var(--border-light);
    }

    #posterCanvas {
      width: 100%;
      height: auto;
      display: block;
      cursor: crosshair;
    }

    /* Step indicators */
    .step-indicator {
      display: inline-flex;
      align-items: center;
      justify-content: center;
      width: 2rem;
      height: 2rem;
      background: var(--brand);
      color: white;
      border-radius: 50%;
      font-weight: 600;
      margin-right: 1rem;
    }

    /* Present section enhancements */
    .checklist {
      list-style: none;
      padding: 0;
      margin: 1.5rem 0;
    }

    .checklist li {
      display: flex;
      align-items: flex-start;
      gap: 1rem;
      margin-bottom: 1rem;
      padding: 1rem;
      background: var(--success-light);
      border-radius: var(--radius-md);
      border-left: 4px solid var(--success);
    }

    .checklist li::before {
      content: "‚úî";
      background: var(--success);
      color: white;
      width: 1.5rem;
      height: 1.5rem;
      border-radius: 50%;
      display: flex;
      align-items: center;
      justify-content: center;
      font-weight: bold;
      font-size: 0.875rem;
      flex-shrink: 0;
    }

    /* Footer enhancement */
    .footer {
      background: linear-gradient(135deg, #1e293b 0%, #0f172a 100%);
      color: #cbd5e1;
      padding: 2.5rem;
      text-align: center;
      margin-top: 4rem;
      border-radius: var(--radius-lg);
      border: 2px solid #334155;
    }

    /* Responsive improvements */
    @media (max-width: 768px) {
      .container {
        padding: 1rem;
      }
      
      .header {
        padding: 2rem 1.5rem;
        text-align: center;
      }
      
      .header h1 {
        font-size: 2rem;
      }
      
      .flip-card {
        height: 450px;
      }
      
      .toolbar {
        padding: 1rem;
      }
      
      .toolbar-group {
        flex-wrap: wrap;
      }
    }

    /* Loading and interaction states */
    .loading {
      opacity: 0.7;
      pointer-events: none;
    }

    .flip-card.transitioning {
      pointer-events: none;
    }

    /* Accessibility improvements */
    @media (prefers-reduced-motion: reduce) {
      * {
        animation-duration: 0.01ms !important;
        animation-iteration-count: 1 !important;
        transition-duration: 0.01ms !important;
      }
    }

    /* Focus indicators */
    button:focus,
    input:focus,
    textarea:focus,
    .flip-card:focus {
      outline: 2px solid var(--brand);
      outline-offset: 2px;
    }
  </style>
</head>

<body>
  <div class="container">
    <!-- Enhanced Header -->
    <header class="header">
      <h1>üåΩ Exploring Mexican Culinary Heritage</h1>
      <p>Instructions in English. Spanish quotes remain in Spanish with translations available.</p>
      <div class="header-links">
        <a href="https://www.spanish-learning-edge.com/post/mexican-food-traditions-an-enduring-heritage" target="_blank" rel="noopener" class="header-link">
          üìñ Related Blog Post
        </a>
      </div>
    </header>

    <!-- Step 1 & 2 - Instructions + Flip Cards -->
    <section class="section card">
      <h2><span class="step-indicator">1</span>Read the Testimonials</h2>
      <p class="text-sm">Read each short quote in Spanish. Click "Show English" to reveal the translation when needed.</p>
      
      <h2 style="margin-top: 2rem;"><span class="step-indicator">2</span>Select ONE Research Topic</h2>
      <p class="text-sm">Click any card to flip and reveal your assigned research topic with vetted sources.</p>

      <div class="flip-grid">
        <!-- Coffee Card -->
        <div class="flip-card" tabindex="0" role="button" aria-label="Coffee Veracruz testimonial and research topic">
          <div class="flip-inner">
            <div class="flip-front">
              <span class="flip-badge">‚òï Caf√© Veracruz</span>
              <button class="translation-btn" data-trans="cafe">Show English</button>
              
              <div class="quote">
                "El cambio clim√°tico est√° afectando nuestros patrones de cosecha. Las lluvias ya no llegan cuando esperamos, pero seguimos adapt√°ndonos como lo hicieron nuestros abuelos. El caf√© de sombra nos ayuda a proteger la biodiversidad mientras mantenemos viva nuestra tradici√≥n."
              </div>
              
              <div class="translation" id="trans-cafe">
                "Climate change is affecting our harvest patterns. The rains no longer arrive when we expect them, but we keep adapting as our elders did. Shade-grown coffee helps protect biodiversity while we keep our tradition alive."
              </div>
              
              <div class="attribution">
                <strong>Attribution:</strong> Coatepec, Veracruz Producer. Source: MDPI <em>Sustainability</em>, 2024 (CC BY 4.0).
              </div>
              
              <div class="flip-hint">Click card to reveal research topic ‚Üª</div>
            </div>
            
            <div class="flip-back">
              <div class="research-topic">
                <h3>üå± Economic Sustainability</h3>
                <ul>
                  <li>How do these traditions generate income and stability for families or co-ops?</li>
                  <li>What concrete mechanisms (jobs, certifications, fairs) make them viable long-term?</li>
                </ul>
                
                <strong>Research Links (CC/Public)</strong>
                <div class="research-links">
                  <ul>
                    <li><a href="https://www.gob.mx/se/articulos/sabias-que-el-cafe-veracruz-tiene-denominacion-de-origen" target="_blank" rel="noopener">Secretar√≠a de Econom√≠a ‚Äì DO Caf√© Veracruz</a></li>
                    <li><a href="https://www.gob.mx/aserca/articulos/cafe-veracruz?idiom=es" target="_blank" rel="noopener">ASERCA ‚Äì Caf√© Veracruz</a></li>
                    <li><a href="https://www.mdpi.com/2071-1050/16/2/802" target="_blank" rel="noopener">MDPI Sustainability ‚Äì Veracruz Coffee</a></li>
                    <li><a href="https://ich.unesco.org/en/decisions/7.COM/9.2" target="_blank" rel="noopener">UNESCO ‚Äì Totonac Program</a></li>
                  </ul>
                </div>
              </div>
              <div class="flip-hint">Click card to flip back ‚Üª</div>
            </div>
          </div>
        </div>

        <!-- Bread Card -->
        <div class="flip-card" tabindex="0" role="button" aria-label="Pan de Fiesta testimonial and research topic">
          <div class="flip-inner">
            <div class="flip-front">
              <span class="flip-badge">üçû Pan de Fiesta</span>
              <button class="translation-btn" data-trans="pan">Show English</button>
              
              <div class="quote">
                "Esta tradici√≥n tiene 307 a√±os en nuestra comunidad. El pan de fiesta no es solo pan‚Äîes nuestra forma de crear redes de reciprocidad. Cuando horneamos para una celebraci√≥n, fortalecemos los lazos que nos unen como pueblo."
              </div>
              
              <div class="translation" id="trans-pan">
                "This tradition has been in our community for 307 years. Celebration bread is not just bread‚Äîit is our way of building reciprocity networks. When we bake for a celebration, we strengthen the bonds that unite us as a people."
              </div>
              
              <div class="attribution">
                <strong>Attribution:</strong> Traditional Baker, San Juan Huactzinco. Source: Congreso del Estado de Tlaxcala / Secretar√≠a de Cultura (public records).
              </div>
              
              <div class="flip-hint">Click card to reveal research topic ‚Üª</div>
            </div>
            
            <div class="flip-back">
              <div class="research-topic">
                <h3>ü§ù Indigenous Reciprocity</h3>
                <ul>
                  <li>How does reciprocity appear in work, celebration, or exchange?</li>
                  <li>What responsibilities accompany the benefits within the community?</li>
                </ul>
                
                <strong>Research Links (CC/Public)</strong>
                <div class="research-links">
                  <ul>
                    <li><a href="https://ich.unesco.org/en/RL/traditional-mexican-cuisine-00400" target="_blank" rel="noopener">UNESCO ‚Äì Traditional Mexican Cuisine</a></li>
                    <li><a href="https://sic.cultura.gob.mx/index.php?table=frpintangible" target="_blank" rel="noopener">Sistema de Informaci√≥n Cultural ‚Äì Registry</a></li>
                    <li><a href="https://huactzinco.gob.mx/cultura/pan-de-fiesta/" target="_blank" rel="noopener">Municipio de Huactzinco ‚Äì Pan de Fiesta</a></li>
                    <li><a href="https://www.gob.mx/cultura/" target="_blank" rel="noopener">Secretar√≠a de Cultura ‚Äì Programs</a></li>
                  </ul>
                </div>
              </div>
              <div class="flip-hint">Click card to flip back ‚Üª</div>
            </div>
          </div>
        </div>

        <!-- Amaranth Card -->
        <div class="flip-card" tabindex="0" role="button" aria-label="Amaranto testimonial and research topic">
          <div class="flip-inner">
            <div class="flip-front">
              <span class="flip-badge">üåæ Amaranto</span>
              <button class="translation-btn" data-trans="amaranto">Show English</button>
              
              <div class="quote">
                "En la √©poca prehisp√°nica, el amaranto conectaba a nuestros ancestros con los dioses. Hoy, las 'alegr√≠as' que producimos conectan el pasado con el presente; son el sustento econ√≥mico de nuestras familias mientras preservamos 6,000 a√±os de historia."
              </div>
              
              <div class="translation" id="trans-amaranto">
                "In pre-Hispanic times, amaranth connected our ancestors with the gods. Today, the 'alegr√≠as' we make connect past and present, providing income for our families while we preserve 6,000 years of history."
              </div>
              
              <div class="attribution">
                <strong>Attribution:</strong> Artisan, Temoac/Huazulco, Morelos. Source: Sistema de Informaci√≥n Cultural & academic reports.
              </div>
              
              <div class="flip-hint">Click card to reveal research topic ‚Üª</div>
            </div>
            
            <div class="flip-back">
              <div class="research-topic">
                <h3>‚úä Cultural Resistance</h3>
                <ul>
                  <li>In what ways do these practices resist homogenization/globalization?</li>
                  <li>Which elements of the tradition are non-negotiable for community identity?</li>
                </ul>
                
                <strong>Research Links (CC/Public)</strong>
                <div class="research-links">
                  <ul>
                    <li><a href="https://ich.unesco.org/en/RL/traditional-mexican-cuisine-00400" target="_blank" rel="noopener">UNESCO ‚Äì Traditional Mexican Cuisine</a></li>
                    <li><a href="https://mediateca.inah.gob.mx/" target="_blank" rel="noopener">Mediateca INAH ‚Äì Collections</a></li>
                    <li><a href="https://www.gob.mx/cultura/prensa/" target="_blank" rel="noopener">Secretar√≠a de Cultura ‚Äì Press</a></li>
                    <li><a href="https://www.nativeseeds.org/products/c020" target="_blank" rel="noopener">Native Seeds/Search ‚Äì Huazulco Amaranth</a></li>
                  </ul>
                </div>
              </div>
              <div class="flip-hint">Click card to flip back ‚Üª</div>
            </div>
          </div>
        </div>
      </div>
    </section>

    <!-- Step 3 - Research Notes -->
    <section class="section card">
      <h2><span class="step-indicator">3</span>Research Notes</h2>
      <p class="text-sm">Use this space to brainstorm and summarize what you found in the sources above.</p>
      <textarea id="notesBox" class="notes-textarea" placeholder="Key findings, quotes with attribution, links you used, emerging connections‚Ä¶"></textarea>
      <div class="notes-status" id="notesStatus">üíæ Saved automatically</div>
    </section>

    <!-- Cultural Note -->
    <section class="section cultural-note">
      <h3>üå°Ô∏è Cultural Note ‚Äì Current Challenges</h3>
      <p>
        Across Mexico's culinary heritage, communities navigate converging pressures from climate change, economic globalization, and cultural displacement. Coffee producers in Veracruz face erratic rainfall disrupting harvest calendars, while traditional bakers in Tlaxcala compete with industrial bread production. Amaranth artisans in Morelos confront market displacement, and indigenous communities nationwide experience erosion of traditional ecological knowledge through youth migration.
      </p>
      <p>
        Climate change threatens to displace 1.4-6.7 million Mexicans by 2080, while trade agreements have already displaced over 1 million farmers. Food sovereignty movements increasingly recognize that preserving culinary heritage requires defending indigenous rights, supporting women's knowledge systems, and maintaining community-controlled agriculture.
      </p>
      
      <button class="references-toggle" onclick="toggleReferences()">
        üìö View Academic References <span id="toggle-icon">‚ñº</span>
      </button>
      
      <div class="references-content" id="references-content">
        <div class="text-xs">
          <strong>Works Cited (MLA Format)</strong><br><br>
          Cabrera-Torres, Jose, et al. "Panorama of Coffee Cultivation in the Central Zone of Veracruz State, Mexico: Identification of Main Stressors and Challenges to Face." <em>Sustainability</em>, vol. 16, no. 2, 2024, article 802. <em>MDPI</em>, doi:10.3390/su16020802.<br><br>
          "Climate Change in Mexico." <em>Wikipedia</em>, 2 June 2025, en.wikipedia.org/wiki/Climate_change_in_Mexico.<br><br>
          Municipio de San Juan Huactzinco. "Pan de Fiesta." <em>Official Municipal Website</em>, huactzinco.gob.mx/cultura/pan-de-fiesta/.<br><br>
          Native Seeds/Search. "Amaranth 'Huazulco Alegr√≠a' ‚Äì Variety Information." <em>Native Seeds/SEARCH</em>, nativeseeds.org/products/c020.<br><br>
          Secretar√≠a de Cultura. "Boletines de Prensa." <em>Gobierno de M√©xico</em>, gob.mx/cultura/prensa/.<br><br>
          "Sin Ma√≠z, No Hay Pa√≠s: How Free Trade Hurts Indigenous Food Sovereignty in Mexico." <em>Center for World Indigenous Studies</em>, 19 Feb. 2025, cwis.org/2025/02/sin-maiz-no-hay-pais-how-free-trade-hurts-indigenous-food-sovereignty-in-mexico/.<br><br>
          UNESCO. "Traditional Mexican Cuisine: Ancestral, Ongoing Community Culture." <em>Intangible Cultural Heritage Lists</em>, 2010, ich.unesco.org/en/RL/traditional-mexican-cuisine-00400.
        </div>
      </div>
    </section>

    <!-- Step 4 - Poster Studio -->
    <section class="section card">
      <h2><span class="step-indicator">4</span>Poster Studio: Create Your Visual Collage</h2>
      <p class="text-sm">Draw, write keywords, and make connections. Save your work as an image for presentation.</p>

      <div class="toolbar">
        <div class="toolbar-group">
          <label>Color</label>
          <input type="color" id="colorPicker" value="#4f46e5"/>
        </div>
        <div class="toolbar-group">
          <label>Size</label>
          <input type="range" id="brushSize" min="2" max="50" value="8" style="width:100px;"/>
          <span id="sizeDisplay">8px</span>
        </div>
        <button class="btn" id="penTool" onclick="setTool('pen')">‚úèÔ∏è Pen</button>
        <button class="btn" id="eraserTool" onclick="setTool('eraser')">üßΩ Eraser</button>
        <button class="btn" id="clearAllBtn" onclick="clearCanvas()">üóëÔ∏è Clear All</button>
        <button class="btn" onclick="undoLast()">‚Ü∂ Undo</button>
        <input type="file" id="imageUpload" accept="image/*" style="display: none;">
        <button class="btn" onclick="document.getElementById('imageUpload').click()">üñºÔ∏è Add Image</button>
        <button class="btn btn-primary" onclick="savePoster()">üíæ Save Poster (PNG)</button>
      </div>

      <div class="canvas-wrapper">
        <canvas id="posterCanvas" width="1200" height="720"></canvas>
      </div>
    </section>

    <!-- Step 5 - Present -->
    <section class="section card">
      <h2><span class="step-indicator">5</span>Present Your Findings</h2>
      <p>Present your poster to the class, explaining how it connects with your research findings and conclusions.</p>
      
      <ul class="checklist">
        <li>Show one concrete mechanism of sustainability, reciprocity, or resistance you identified.</li>
        <li>Cite at least one vetted source and explain why it is trustworthy.</li>
        <li>State one open question or next step for community-centered preservation.</li>
      </ul>
    </section>

    <!-- Footer -->
    <footer class="footer">
      <p><strong>Cultural Recognition:</strong> This knowledge belongs to the Mexican communities who keep these traditions alive today. Their ancestral wisdom must be respected as a living tradition, not as a historical curiosity.</p>
      <p style="margin-top: 1.5rem;">¬© 2025 Spanish Learning Edge LLC. All rights reserved.</p>
      <p class="text-xs">Designed using instructional expertise and AI-assisted tools. Not for redistribution without permission.</p>
    </footer>
  </div>

  <script>
    // Enhanced flip card functionality - FIXED VERSION
    let currentTool = 'pen';
    let isDrawing = false;
    let lastPoint = { x: 0, y: 0 };
    let drawingHistory = [];
    let historyStep = -1;

    // Flip cards with improved interaction - FIXED
    document.querySelectorAll('.flip-card').forEach(card => {
      // Click handler for the entire card
      card.addEventListener('click', function(e) {
        // Don't flip if clicking on buttons or links
        if (e.target.closest('button, a')) {
          return;
        }
        
        card.classList.add('transitioning');
        card.classList.toggle('is-flipped');
        
        setTimeout(() => {
          card.classList.remove('transitioning');
        }, 800);
      });
      
      // Keyboard handler for accessibility
      card.addEventListener('keydown', function(e) {
        if (e.key === 'Enter' || e.key === ' ') {
          e.preventDefault();
          card.classList.add('transitioning');
          card.classList.toggle('is-flipped');
          
          setTimeout(() => {
            card.classList.remove('transitioning');
          }, 800);
        }
      });
    });

    // Translation toggle - FIXED
    document.querySelectorAll('.translation-btn').forEach(btn => {
      btn.addEventListener('click', function(e) {
        e.stopPropagation(); // Prevent card flip
        const transId = 'trans-' + this.dataset.trans;
        const translationBox = document.getElementById(transId);
        
        if (translationBox) {
          const isVisible = translationBox.style.display === 'block';
          translationBox.style.display = isVisible ? 'none' : 'block';
          this.textContent = isVisible ? 'Show English' : 'Hide English';
          this.classList.toggle('active', !isVisible);
        }
      });
    });

    // Notes functionality with autosave
    const notesBox = document.getElementById('notesBox');
    const notesStatus = document.getElementById('notesStatus');
    let saveTimeout;

    if (notesBox) {
      // Load saved notes
      const savedNotes = localStorage.getItem('mexican_heritage_notes');
      if (savedNotes) {
        notesBox.value = savedNotes;
      }
      
      // Autosave with status indicator
      notesBox.addEventListener('input', function() {
        clearTimeout(saveTimeout);
        saveTimeout = setTimeout(() => {
          localStorage.setItem('mexican_heritage_notes', notesBox.value);
          notesStatus.classList.add('show');
          setTimeout(() => {
            notesStatus.classList.remove('show');
          }, 2000);
        }, 500);
      });
    }

    // Drawing functionality
    const canvas = document.getElementById('posterCanvas');
    const ctx = canvas ? canvas.getContext('2d', { willReadFrequently: true }) : null;
    
    if (ctx) {
      const colorPicker = document.getElementById('colorPicker');
      const brushSize = document.getElementById('brushSize');
      const sizeDisplay = document.getElementById('sizeDisplay');
      const penTool = document.getElementById('penTool');
      const eraserTool = document.getElementById('eraserTool');

      // Initialize canvas with white background
      ctx.fillStyle = 'white';
      ctx.fillRect(0, 0, canvas.width, canvas.height);

      // Update size display
      brushSize.addEventListener('input', function() {
        sizeDisplay.textContent = this.value + 'px';
      });

      // Tool selection
      window.setTool = function(tool) {
        currentTool = tool;
        penTool.classList.toggle('active', tool === 'pen');
        eraserTool.classList.toggle('active', tool === 'eraser');
        
        // Update cursor
        canvas.style.cursor = tool === 'pen' ? 'crosshair' : 'grab';
      };

      // Initialize with pen tool
      setTool('pen');
      
      // Save state for undo
      function saveState() {
        historyStep++;
        if (historyStep < drawingHistory.length) {
          drawingHistory.length = historyStep;
        }
        drawingHistory.push(canvas.toDataURL());
        
        // Limit history to 20 states
        if (drawingHistory.length > 20) {
          drawingHistory.shift();
          historyStep--;
        }
      }
      
      // Initial state
      saveState();

      // Undo functionality
      window.undoLast = function() {
        if (historyStep > 0) {
          historyStep--;
          const img = new Image();
          img.onload = function() {
            ctx.clearRect(0, 0, canvas.width, canvas.height);
            ctx.drawImage(img, 0, 0);
          };
          img.src = drawingHistory[historyStep];
        }
      };

      // Get pointer position
      function getPointerPos(evt) {
        const rect = canvas.getBoundingClientRect();
        const scaleX = canvas.width / rect.width;
        const scaleY = canvas.height / rect.height;
        
        const clientX = evt.touches ? evt.touches[0].clientX : evt.clientX;
        const clientY = evt.touches ? evt.touches[0].clientY : evt.clientY;
        
        return {
          x: (clientX - rect.left) * scaleX,
          y: (clientY - rect.top) * scaleY
        };
      }

      // Drawing functions
      function startDrawing(evt) {
        evt.preventDefault();
        isDrawing = true;
        lastPoint = getPointerPos(evt);
        
        ctx.lineCap = 'round';
        ctx.lineJoin = 'round';
        ctx.lineWidth = parseInt(brushSize.value, 10);
        
        if (currentTool === 'pen') {
          ctx.globalCompositeOperation = 'source-over';
          ctx.strokeStyle = colorPicker.value;
        } else {
          ctx.globalCompositeOperation = 'destination-out';
        }
      }

      function draw(evt) {
        if (!isDrawing) return;
        evt.preventDefault();
        
        const currentPoint = getPointerPos(evt);
        ctx.beginPath();
        ctx.moveTo(lastPoint.x, lastPoint.y);
        ctx.lineTo(currentPoint.x, currentPoint.y);
        ctx.stroke();
        lastPoint = currentPoint;
      }

      function stopDrawing() {
        if (isDrawing) {
          isDrawing = false;
          saveState();
        }
      }

      // Mouse events
      canvas.addEventListener('mousedown', startDrawing);
      canvas.addEventListener('mousemove', draw);
      canvas.addEventListener('mouseup', stopDrawing);
      canvas.addEventListener('mouseout', stopDrawing);

      // Touch events
      canvas.addEventListener('touchstart', startDrawing, { passive: false });
      canvas.addEventListener('touchmove', draw, { passive: false });
      canvas.addEventListener('touchend', stopDrawing);

      // Clear canvas
      window.clearCanvas = function() {
        if (confirm('Are you sure you want to clear the entire canvas?')) {
          ctx.fillStyle = 'white';
          ctx.fillRect(0, 0, canvas.width, canvas.height);
          saveState();
          
          // Visual feedback
          const clearBtn = document.getElementById('clearAllBtn');
          if (clearBtn) {
            const originalText = clearBtn.textContent;
            clearBtn.textContent = '‚úî Cleared';
            clearBtn.style.background = '#ef7c8e';
            clearBtn.style.color = 'white';
            
            setTimeout(() => {
              clearBtn.textContent = originalText;
              clearBtn.style.background = '';
              clearBtn.style.color = '';
            }, 1500);
          }
        }
      };

      // Image upload
      document.getElementById('imageUpload').addEventListener('change', function(e) {
        const file = e.target.files[0];
        if (file) {
          const reader = new FileReader();
          reader.onload = function(event) {
            const img = new Image();
            img.onload = function() {
              // Calculate size
              const maxWidth = 300;
              const maxHeight = 300;
              let width = img.width;
              let height = img.height;
              
              if (width > maxWidth || height > maxHeight) {
                const ratio = Math.min(maxWidth / width, maxHeight / height);
                width *= ratio;
                height *= ratio;
              }
              
              // Draw centered
              const x = (canvas.width - width) / 2;
              const y = (canvas.height - height) / 2;
              ctx.drawImage(img, x, y, width, height);
              saveState();
            };
            img.src = event.target.result;
          };
          reader.readAsDataURL(file);
        }
      });

      // Save poster
      window.savePoster = function() {
        const link = document.createElement('a');
        link.download = 'mexican-culinary-heritage-poster.png';
        link.href = canvas.toDataURL('image/png', 1.0);
        link.click();
        
        // Visual feedback
        const btn = event.target;
        const originalText = btn.textContent;
        btn.textContent = '‚úî Saved!';
        btn.disabled = true;
        
        setTimeout(() => {
          btn.textContent = originalText;
          btn.disabled = false;
        }, 2000);
      };
    }

    // References toggle
    window.toggleReferences = function() {
      const content = document.getElementById('references-content');
      const icon = document.getElementById('toggle-icon');
      const isVisible = content.classList.contains('show');
      
      content.classList.toggle('show');
      icon.textContent = isVisible ? '‚ñº' : '‚ñ≤';
    };

    console.log('üå∂Ô∏è Mexican Culinary Heritage Activity loaded successfully!');
  </script>
</body>
</html>
