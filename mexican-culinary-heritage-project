<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8"/>
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>Exploring Mexican Culinary Heritage — Interactive Activity</title>
  <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&family=Crimson+Text:ital,wght@0,400;0,600;1,400&display=swap" rel="stylesheet">

  <style>
    :root{
      --brand:#4f46e5;--brand-light:#6366f1;--accent:#7c3aed;--accent-light:#8b5cf6;--success:#ef7c8e;--success-light:#ffe8e3;
      --warning:#d97706;--ink:#0f172a;--text-muted:#64748b;--text-light:#94a3b8;--bg-primary:#ffffff;--bg-secondary:#f8fafc;--bg-tertiary:#f1f5f9;
      --border-light:#e2e8f0;--border-medium:#cbd5e1;--shadow-sm:0 1px 2px 0 rgb(0 0 0 / 0.05);--shadow-md:0 4px 6px -1px rgb(0 0 0 / 0.1),0 2px 4px -2px rgb(0 0 0 / 0.1);
      --shadow-lg:0 10px 15px -3px rgb(0 0 0 / 0.1),0 4px 6px -4px rgb(0 0 0 / 0.1);--shadow-xl:0 20px 25px -5px rgb(0 0 0 / 0.1),0 8px 10px -6px rgb(0 0 0 / 0.1);
      --radius-sm:8px;--radius-md:12px;--radius-lg:16px;--transition-fast:0.15s ease-out;--transition-medium:0.25s ease-out;--transition-slow:0.35s cubic-bezier(0.4,0,0.2,1);
    }
    *{box-sizing:border-box}
    html,body{margin:0;padding:0;font-family:'Inter',system-ui,-apple-system,'Segoe UI',Roboto,sans-serif;font-size:16px;line-height:1.6;color:var(--ink);
      background:linear-gradient(135deg,#f8fafc 0%,#e2e8f0 100%);scroll-behavior:smooth}

    h1,h2,h3{font-family:'Crimson Text',serif;font-weight:600;line-height:1.2;margin:0}
    h1{font-size:2.5rem;color:var(--brand)} h2{font-size:1.875rem;color:var(--ink);margin-bottom:1rem} h3{font-size:1.5rem;color:var(--brand);margin-bottom:.75rem}
    p{margin:0 0 1rem}.text-sm{font-size:.875rem;color:var(--text-muted)}.text-xs{font-size:.75rem;color:var(--text-light)}
    a{color:var(--accent);text-decoration:none;transition:color var(--transition-fast)} a:hover{color:var(--brand)}

    .container{max-width:1200px;margin:0 auto;padding:2rem 1.5rem}.section{margin-bottom:3rem}
    .card{background:var(--bg-primary);border:1px solid var(--border-light);border-radius:var(--radius-lg);padding:2rem;box-shadow:var(--shadow-md);transition:box-shadow var(--transition-medium)}
    .card:hover{box-shadow:var(--shadow-lg)}

    .header{background:linear-gradient(135deg,var(--bg-primary) 0%,var(--bg-secondary) 100%);border:2px solid var(--border-light);border-left:6px solid var(--brand);
      border-radius:var(--radius-lg);padding:2.5rem;box-shadow:var(--shadow-xl);margin-bottom:3rem;text-align:center}
    .header h1{margin-bottom:1rem}
    .header-links{display:flex;justify-content:center;gap:1rem;margin-top:1.25rem;flex-wrap:wrap}
    .header-link{display:inline-flex;align-items:center;gap:.5rem;padding:.75rem 1.25rem;background:var(--bg-primary);border:1px solid var(--border-light);
      border-radius:var(--radius-md);font-weight:500;transition:all var(--transition-medium);box-shadow:var(--shadow-sm)}
    .header-link:hover{transform:translateY(-2px);box-shadow:var(--shadow-md);border-color:var(--brand)}

    .flip-grid{display:grid;grid-template-columns:repeat(3,1fr);gap:1.5rem;margin-top:2rem;max-width:100%}
    @media (max-width:1024px){.flip-grid{grid-template-columns:repeat(2,1fr);gap:1.25rem}}
    @media (max-width:768px){.flip-grid{grid-template-columns:1fr;gap:1rem}}
    .flip-card{perspective:1200px;height:500px;cursor:pointer;transition:transform var(--transition-medium);width:100%}
    .flip-card:hover{transform:scale(1.02)} .flip-card:focus{outline:3px solid var(--brand);outline-offset:4px}
    .flip-inner{position:relative;width:100%;height:100%;transform-style:preserve-3d;transition:transform .8s cubic-bezier(.175,.885,.32,1.275)}
    .flip-card.is-flipped .flip-inner{transform:rotateY(180deg)}
    .flip-front,.flip-back{position:absolute;inset:0;backface-visibility:hidden;border-radius:var(--radius-lg);border:2px solid var(--border-light);background:var(--bg-primary);
      box-shadow:var(--shadow-lg);padding:1.5rem;display:flex;flex-direction:column;gap:.75rem;overflow-y:auto;font-size:.9rem}
    .flip-front{border-top:6px solid var(--brand)} .flip-back{border-top:6px solid var(--accent);transform:rotateY(180deg)}
    .flip-badge{align-self:flex-start;background:linear-gradient(135deg,var(--brand) 0%,var(--brand-light) 100%);color:#fff;padding:.5rem 1rem;border-radius:999px;font-size:.875rem;font-weight:600;box-shadow:var(--shadow-md)}
    .translation-btn{align-self:flex-start;background:var(--bg-secondary);border:1px solid var(--border-medium);padding:.5rem 1rem;border-radius:var(--radius-md);font-size:.8rem;font-weight:500;cursor:pointer;transition:all var(--transition-medium);box-shadow:var(--shadow-sm)}
    .translation-btn:hover,.translation-btn.active{background:var(--brand);color:#fff;transform:translateY(-1px);box-shadow:var(--shadow-md)}
    .quote{font-family:'Crimson Text',serif;font-size:.95rem;line-height:1.5;font-style:italic;color:var(--ink);background:linear-gradient(135deg,#e0e7ff 0%,#ddd6fe 100%);
      padding:1rem;border-radius:var(--radius-md);border:2px solid var(--brand);margin:.5rem 0}
    .attribution{font-size:.75rem;color:var(--text-muted);padding:.75rem;background:var(--bg-secondary);border-radius:var(--radius-sm);border:1px solid var(--border-light);margin-top:auto}
    .translation{display:none;font-style:italic;color:var(--text-muted);background:var(--success-light);padding:1rem;border-radius:var(--radius-sm);border-left:4px solid var(--success);font-size:.85rem;margin:.5rem 0;animation:fadeIn var(--transition-medium)}
    @keyframes fadeIn{from{opacity:0;transform:translateY(-10px)}to{opacity:1;transform:translateY(0)}}
    .flip-hint{margin-top:auto;text-align:center;color:var(--text-light);font-size:.8rem;padding:.75rem;background:var(--bg-tertiary);border-radius:var(--radius-sm);animation:pulse 2s ease-in-out infinite}
    @keyframes pulse{0%,100%{opacity:.6}50%{opacity:1}}

    .research-topic h3{display:flex;align-items:center;gap:.5rem;margin-bottom:1rem;font-size:1.2rem}
    .research-topic ul{margin:0 0 .75rem 0;padding-left:1.25rem}
    .research-topic li{margin-bottom:.5rem;color:var(--text-muted);font-size:.85rem;line-height:1.4}
    .research-links{background:var(--bg-tertiary);padding:.75rem;border-radius:var(--radius-md);max-height:180px;overflow-y:auto;flex:1}
    .research-links strong{display:block;margin-bottom:.5rem;font-size:.9rem}
    .research-links ul{margin:0;padding:0;list-style:none}
    .research-links li{margin-bottom:.5rem}
    .research-links a{display:block;padding:.5rem;background:var(--bg-primary);border:1px solid var(--border-light);border-radius:var(--radius-sm);transition:all var(--transition-medium);box-shadow:var(--shadow-sm);font-size:.8rem}
    .research-links a:hover{background:var(--brand);color:#fff;transform:translateX(4px);box-shadow:var(--shadow-md)}

    .notes-textarea{width:100%;min-height:200px;border:2px solid var(--border-light);border-radius:var(--radius-md);padding:1.5rem;font-family:inherit;font-size:1rem;line-height:1.6;resize:vertical;transition:border-color var(--transition-medium);background:var(--success-light)}
    .notes-textarea:focus{outline:none;border-color:var(--success);background:var(--bg-primary);box-shadow:0 0 0 3px rgb(239 124 142 / 0.1)}
    .notes-status{display:inline-flex;align-items:center;gap:.5rem;margin-top:.75rem;padding:.5rem 1rem;background:var(--success);color:#fff;border-radius:var(--radius-sm);font-size:.875rem;font-weight:500;opacity:0;transition:opacity var(--transition-medium)}
    .notes-status.show{opacity:1}

    .toolbar{display:flex;flex-wrap:wrap;gap:1rem;align-items:center;margin-bottom:1.5rem;padding:1.5rem;background:var(--bg-secondary);border-radius:var(--radius-md);border:1px solid var(--border-light)}
    .toolbar-group{display:flex;gap:.75rem;align-items:center;padding:.75rem 1rem;background:var(--bg-primary);border:1px solid var(--border-light);border-radius:var(--radius-md);box-shadow:var(--shadow-sm)}
    .toolbar-group label{font-weight:500;color:var(--text-muted);font-size:.875rem}
    .btn{appearance:none;border:1px solid var(--border-medium);background:var(--bg-primary);padding:.75rem 1.25rem;border-radius:var(--radius-md);cursor:pointer;font-weight:500;transition:all var(--transition-medium);box-shadow:var(--shadow-sm);display:inline-flex;align-items:center;gap:.5rem}
    .btn:hover{background:var(--bg-tertiary);transform:translateY(-1px);box-shadow:var(--shadow-md)}
    .btn.active{background:var(--brand);color:#fff;border-color:var(--brand)}
    .btn-primary{background:linear-gradient(135deg,var(--brand) 0%,var(--accent) 100%);color:#fff;border:none;font-weight:600;box-shadow:var(--shadow-md)}
    .btn-primary:hover{transform:translateY(-2px);box-shadow:var(--shadow-lg)}

    .canvas-wrapper{position:relative;border-radius:var(--radius-lg);overflow:hidden;background:var(--bg-primary);box-shadow:var(--shadow-lg);border:2px solid var(--border-light)}
    #drawCanvas,#mediaCanvas,#notesCanvas{display:block;width:100%;height:auto}
    #drawCanvas{position:relative;z-index:1}
    #mediaCanvas{position:absolute;inset:0;z-index:2}
    #notesCanvas{position:absolute;inset:0;z-index:3;touch-action:none} /* importante para touch */

    .step-indicator{display:inline-flex;align-items:center;justify-content:center;width:2rem;height:2rem;background:var(--brand);color:#fff;border-radius:50%;font-weight:600;margin-right:1rem}
    .checklist{list-style:none;padding:0;margin:1.5rem 0}
    .checklist li{display:flex;align-items:flex-start;gap:1rem;margin-bottom:1rem;padding:1rem;background:var(--success-light);border-radius:var(--radius-md);border-left:4px solid var(--success)}
    .checklist li::before{content:"✓";background:var(--success);color:#fff;width:1.5rem;height:1.5rem;border-radius:50%;display:flex;align-items:center;justify-content:center;font-weight:bold;font-size:.875rem;flex-shrink:0}

     /* Cultural Note + References */
.cultural-note{
  background: linear-gradient(135deg,#ffe8e3 0%,#f1f5f9 100%);
  border-left: 6px solid var(--success);
  border-radius: var(--radius-lg);
  padding: 2rem;
  margin: 2rem 0;
  box-shadow: var(--shadow-lg);
}
.cultural-note h3{
  display: flex;
  align-items: center;
  gap: .75rem;
  margin-bottom: 1.5rem;
}

/* Botón mostrar/ocultar referencias */
.references-toggle{
  background: var(--success-light);
  border: 2px solid var(--success);
  color: var(--ink);
  padding: .75rem 1.25rem;
  border-radius: var(--radius-md);
  cursor: pointer;
  font-weight: 500;
  display: inline-flex;
  align-items: center;
  gap: .5rem;
  transition: all var(--transition-medium);
  box-shadow: var(--shadow-sm);
}
.references-toggle:hover{
  background: var(--success);
  color: #fff;
  transform: translateY(-1px);
  box-shadow: var(--shadow-md);
}

/* Contenedor colapsable */
.references-content{
  display: none;
  margin-top: 1rem;
  padding: 1.5rem;
  background: rgba(255,255,255,.8);
  border-radius: var(--radius-sm);
  border: 1px solid var(--success);
  animation: fadeIn var(--transition-medium);
}
.references-content.show{ display:block; }
    .footer{background:linear-gradient(135deg,#1e293b 0%,#0f172a 100%);color:#cbd5e1;padding:2.5rem;text-align:center;margin-top:4rem;border-radius:var(--radius-lg);border:2px solid #334155}

    @media (max-width:768px){
      .container{padding:1rem}
      .header{padding:2rem 1.5rem}
      .header h1{font-size:2rem}
      .flip-card{height:450px}
      .toolbar{padding:1rem}
      .toolbar-group{flex-wrap:wrap}
    }
    .loading{opacity:.7;pointer-events:none}
    .flip-card.transitioning{pointer-events:none}
    @media (prefers-reduced-motion:reduce){*{animation-duration:.01ms!important;animation-iteration-count:1!important;transition-duration:.01ms!important}}
    button:focus,input:focus,textarea:focus,.flip-card:focus{outline:2px solid var(--brand);outline-offset:2px}
  </style>
</head>

  <body>
  <div class="container">
    <header class="header">
      <h1>🌽 Exploring Mexican Culinary Heritage</h1>
      <p class="text-sm"><strong>🎯 Learning Objectives:</strong> Analyze how Mexican foodways demonstrate <em>Economic Sustainability</em>, <em>Indigenous Reciprocity</em>, or <em>Cultural Resistance</em> | Evaluate contemporary challenges these traditions face | Create connections between Mexican cultural practices and your own community food traditions.</p>
      <div class="header-links">
        <a href="https://www.spanish-learning-edge.com/post/mexican-food-traditions-an-enduring-heritage" target="_blank" rel="noopener" class="header-link">📖 Related Blog Post</a>
      </div>
    </header>

    <section class="section card">
      <h2><span class="step-indicator">1</span>Read the Testimonials</h2>
      <p class="text-sm"><strong>Purpose:</strong> Build cultural understanding from community voices. <strong>What to do:</strong> Read each short quote in Spanish. Click <em>Show English</em> as needed to confirm meaning.</p>

      <h2 style="margin-top:2rem;"><span class="step-indicator">2</span>Select ONE Research Topic</h2>
      <p class="text-sm"><strong>What to do:</strong> Click any card to flip and reveal guiding questions and suggested sources. Choose ONE topic to research and analyze.</p>

      <div class="flip-grid">
        <!-- Coffee -->
        <div class="flip-card" tabindex="0" role="button" aria-label="Coffee Veracruz testimonial and research topic">
          <div class="flip-inner">
            <div class="flip-front">
              <span class="flip-badge">☕ Café Veracruz</span>
              <button class="translation-btn" data-trans="cafe">Show English</button>
              <div class="quote">"El cambio climático está afectando nuestros patrones de cosecha. Las lluvias ya no llegan cuando esperamos, pero seguimos adaptándonos como lo hicieron nuestros abuelos. El café de sombra nos ayuda a proteger la biodiversidad mientras mantenemos viva nuestra tradición."</div>
              <div class="translation" id="trans-cafe">"Climate change is affecting our harvest patterns. The rains no longer arrive when we expect them, but we keep adapting as our elders did. Shade-grown coffee helps protect biodiversity while we keep our tradition alive."</div>
              <div class="attribution"><strong>Attribution:</strong> Coatepec, Veracruz Producer. Source: MDPI <em>Sustainability</em>, 2024 (CC BY 4.0).</div>
              <div class="flip-hint">Click card to reveal research topic ↻</div>
            </div>
            <div class="flip-back">
              <div class="research-topic">
                <h3>🌱 Economic Sustainability</h3>
                <ul>
                  <li>How do these traditions generate income and stability for families or co-ops?</li>
                  <li>What concrete mechanisms (jobs, certifications, fairs) make them viable long-term?</li>
                </ul>
                <strong>Research Links (CC/Public)</strong>
                <div class="research-links">
                  <ul>
                    <li><a href="https://www.gob.mx/se/articulos/sabias-que-el-cafe-veracruz-tiene-denominacion-de-origen" target="_blank" rel="noopener">Secretaría de Economía — DO Café Veracruz</a></li>
                    <li><a href="https://www.mdpi.com/2071-1050/16/2/802" target="_blank" rel="noopener">MDPI Sustainability — Veracruz Coffee</a></li>
                    <li><a href="https://ich.unesco.org/en/decisions/7.COM/9.2" target="_blank" rel="noopener">UNESCO — Totonac Program</a></li>
                  </ul>
                </div>
              </div>
              <div class="flip-hint">Click card to flip back ↻</div>
            </div>
          </div>
        </div>

        <!-- Bread -->
        <div class="flip-card" tabindex="0" role="button" aria-label="Pan de Fiesta testimonial and research topic">
          <div class="flip-inner">
            <div class="flip-front">
              <span class="flip-badge">🍞 Pan de Fiesta</span>
              <button class="translation-btn" data-trans="pan">Show English</button>
              <div class="quote">"Esta tradición tiene 307 años en nuestra comunidad. El pan de fiesta no es solo pan—es nuestra forma de crear redes de reciprocidad. Cuando horneamos para una celebración, fortalecemos los lazos que nos unen como pueblo."</div>
              <div class="translation" id="trans-pan">"This tradition has been in our community for 307 years. Celebration bread is not just bread—it is our way of building reciprocity networks."</div>
              <div class="attribution"><strong>Attribution:</strong> Traditional Baker, San Juan Huactzinco. Public records.</div>
              <div class="flip-hint">Click card to reveal research topic ↻</div>
            </div>
            <div class="flip-back">
              <div class="research-topic">
                <h3>🫶🏽 Indigenous Reciprocity</h3>
                <ul>
                  <li>How does reciprocity appear in work, celebration, or exchange?</li>
                  <li>What responsibilities accompany the benefits within the community?</li>
                </ul>
                <strong>Research Links (CC/Public)</strong>
                <div class="research-links">
                  <ul>
                    <li><a href="https://ich.unesco.org/en/RL/traditional-mexican-cuisine-00400" target="_blank" rel="noopener">UNESCO — Traditional Mexican Cuisine</a></li>
                    <li><a href="https://huactzinco.gob.mx/cultura/pan-de-fiesta/" target="_blank" rel="noopener">Municipio de Huactzinco — Pan de Fiesta</a></li>
                  </ul>
                </div>
              </div>
              <div class="flip-hint">Click card to flip back ↻</div>
            </div>
          </div>
        </div>

        <!-- Amaranth -->
        <div class="flip-card" tabindex="0" role="button" aria-label="Amaranth testimonial and research topic">
          <div class="flip-inner">
            <div class="flip-front">
              <span class="flip-badge">🌾 Amaranto</span>
              <button class="translation-btn" data-trans="amaranto">Show English</button>
              <div class="quote">"En la época prehispánica, el amaranto conectaba a nuestros ancestros con los dioses. Hoy, las 'alegrías' conectan pasado y presente y sostienen a nuestras familias."</div>
              <div class="translation" id="trans-amaranto">"In pre-Hispanic times, amaranth connected our ancestors with the gods. Today, 'alegrías' connect past and present and support our families."</div>
              <div class="attribution"><strong>Attribution:</strong> Artisan, Temoac/Huazulco, Morelos.</div>
              <div class="flip-hint">Click card to reveal research topic ↻</div>
            </div>
            <div class="flip-back">
              <div class="research-topic">
                <h3>🦾 Cultural Resistance</h3>
                <ul>
                  <li>In what ways do these practices resist homogenization/globalization?</li>
                  <li>Which elements are non-negotiable for identity?</li>
                </ul>
                <strong>Research Links (CC/Public)</strong>
                <div class="research-links">
                  <ul>
                    <li><a href="https://ich.unesco.org/en/RL/traditional-mexican-cuisine-00400" target="_blank" rel="noopener">UNESCO — Traditional Mexican Cuisine</a></li>
                    <li><a href="https://mediateca.inah.gob.mx/" target="_blank" rel="noopener">Mediateca INAH — Collections</a></li>
                  </ul>
                </div>
              </div>
              <div class="flip-hint">Click card to flip back ↻</div>
            </div>
          </div>
        </div>
      </div>
    </section>

    <section class="section card">
      <h2><span class="step-indicator">3</span>Research & Comparative Analysis</h2>
      <p class="text-sm">Investigate your chosen focus area. Document evidence supporting sustainability, reciprocity, or resistance. Then contrast with your family/community.</p>
      <textarea id="notesBox" class="notes-textarea" placeholder="Evidence → Analysis → Local comparison… "></textarea>
      <div class="notes-status" id="notesStatus">💾 Saved automatically</div>
    </section>

        <section class="section card">
      <h2><span class="step-indicator">4</span>Poster Studio: Create Your Visual Synthesis</h2>
      <p class="text-sm">Include links to videos, add sticky notes, draw arrows or lines, and add photos to synthesize your research findings into a visual presentation.</p>

      <div class="toolbar">
        <div class="toolbar-group">
          <label>Color</label>
          <input type="color" id="colorPicker" value="#4f46e5"/>
        </div>
        <div class="toolbar-group">
          <label>Size</label>
          <input type="range" id="brushSize" min="2" max="50" value="8" style="width:110px"/>
          <span id="sizeDisplay">8px</span>
        </div>

        <button class="btn" id="penTool">✏️ Pen</button>
        <button class="btn" id="eraserTool">🧽 Eraser</button>
        <button class="btn" id="clearAllBtn">🗑️ Clear All</button>
        <button class="btn" id="undoBtn">↶ Undo</button>

        <input type="file" id="imageUpload" accept="image/*" style="display:none">
        <button class="btn" id="addImgBtn">🖼️ Add Image</button>

        <div class="toolbar-group">
          <label for="noteText">Mini Sticky Notes</label>
          <input id="noteText" type="text" placeholder="Type a tip or paste a link…" style="padding:.5rem;border:1px solid var(--border-light);border-radius:8px;min-width:220px">
          <select id="noteSize" style="padding:.5rem;border:1px solid var(--border-light);border-radius:8px">
            <option value="14">Small</option><option value="16" selected>Medium</option><option value="20">Large</option>
          </select>
          <select id="noteColor" title="Note color" style="padding:.5rem;border:1px solid var(--border-light);border-radius:8px">
            <option value="0" selected>Yellow</option><option value="1">Blue</option><option value="2">Gold</option><option value="3">Rose</option><option value="4">Lavender</option>
          </select>
          <button class="btn" id="addNoteBtn">🗒️ Add Note</button>
        </div>

        <button class="btn btn-primary" id="saveBtn">💾 Save Poster (PNG)</button>
      </div>

      <div class="canvas-wrapper" style="max-width:1200px;margin-inline:auto">
        <canvas id="drawCanvas"  width="1200" height="720"></canvas>
        <canvas id="mediaCanvas" width="1200" height="720"></canvas>
        <canvas id="notesCanvas" width="1200" height="720"></canvas>
      </div>
      <p class="text-xs" id="noteHint" style="margin-top:.5rem;display:none">Tip: tap/click anywhere to place your note. Drag notes to reposition. Double-click to open links. Esc cancels.</p>
    </section>

    <section class="section card">
      <h2><span class="step-indicator">5</span>Present Your Findings</h2>
      <ul class="checklist">
        <li>(a) Explain your analysis of sustainability, reciprocity, or resistance.</li>
        <li>(b) Contrast with your personal example (family, community, or country).</li>
        <li>(c) Share a closing reflection—see example below. You may also explore the current challenge related to your topic.</li>
      </ul>
    </section>

    <section class="section cultural-note">
  <h3>🌡️ Closing Reflection — Current Challenges</h3>
  <p>
    Across Mexico's culinary heritage, communities navigate converging pressures from climate change, economic globalization, and cultural displacement. Coffee producers in Veracruz face erratic rainfall disrupting harvest calendars, while traditional bakers in Tlaxcala compete with industrial bread production. Amaranth artisans in Morelos confront market displacement, and indigenous communities nationwide experience erosion of traditional ecological knowledge through youth migration.
  </p>
  <p>
    Climate change threatens to displace 1.4–6.7 million Mexicans by 2080, while trade agreements have already displaced over 1 million farmers. Food sovereignty movements increasingly recognize that preserving culinary heritage requires defending indigenous rights, supporting women's knowledge systems, and maintaining community-controlled agriculture.
  </p>
  <button class="references-toggle" onclick="toggleReferences()">📚 View Academic References <span id="toggle-icon">▼</span></button>
  <div class="references-content" id="references-content">
    <div class="text-xs">
      <strong>Works Cited (MLA Format)</strong><br><br>
      Cabrera-Torres, Jose, et al. "Panorama of Coffee Cultivation in the Central Zone of Veracruz State, Mexico: Identification of Main Stressors and Challenges to Face." <em>Sustainability</em>, vol. 16, no. 2, 2024, article 802. <em>MDPI</em>, doi:10.3390/su16020802.<br><br>
      "Climate Change in Mexico." <em>Wikipedia</em>, 2 June 2025, en.wikipedia.org/wiki/Climate_change_in_Mexico.<br><br>
      Municipio de San Juan Huactzinco. "Pan de Fiesta." <em>Official Municipal Website</em>, huactzinco.gob.mx/cultura/pan-de-fiesta/.<br><br>
      Native Seeds/Search. "Amaranth 'Huazulco Alegría' – Variety Information." <em>Native Seeds/SEARCH</em>, nativeseeds.org/products/c020.<br><br>
      Secretaría de Cultura. "Boletines de Prensa." <em>Gobierno de México</em>, gob.mx/cultura/prensa/.<br><br>
      "Sin Maíz, No Hay País: How Free Trade Hurts Indigenous Food Sovereignty in Mexico." <em>Center for World Indigenous Studies</em>, 19 Feb. 2025, cwis.org/2025/02/sin-maiz-no-hay-pais-how-free-trade-hurts-indigenous-food-sovereignty-in-mexico/.<br><br>
      UNESCO. "Traditional Mexican Cuisine: Ancestral, Ongoing Community Culture." <em>Intangible Cultural Heritage Lists</em>, 2010, ich.unesco.org/en/RL/traditional-mexican-cuisine-00400.
    </div>
  </div>
</section>
    
    <footer class="footer">
      <p><strong>Cultural Recognition:</strong> This knowledge belongs to the Mexican communities who keep these traditions alive today.</p>
      <p style="margin-top:1.5rem;">© 2025 Spanish Learning Edge LLC. All rights reserved.</p>
      <p class="text-xs">Designed using instructional expertise and AI-assisted tools. Not for redistribution without permission.</p>
    </footer>
  </div>

   <script>
document.addEventListener('DOMContentLoaded', () => {
  /* ---- Flip cards ---- */
  document.querySelectorAll('.flip-card').forEach(card=>{
    card.addEventListener('click',e=>{
      if(e.target.closest('button,a')) return;
      card.classList.add('transitioning');
      card.classList.toggle('is-flipped');
      setTimeout(()=>card.classList.remove('transitioning'),800);
    });
    card.addEventListener('keydown',e=>{
      if(e.key==='Enter'||e.key===' '){
        e.preventDefault();
        card.classList.add('transitioning');
        card.classList.toggle('is-flipped');
        setTimeout(()=>card.classList.remove('transitioning'),800);
      }
    });
  });

  /* ---- Show English ---- */
  document.querySelectorAll('.translation-btn').forEach(btn=>{
    btn.addEventListener('click',()=>{
      const el=document.getElementById('trans-'+btn.dataset.trans);
      if(!el) return;
      const on=el.style.display==='block';
      el.style.display=on?'none':'block';
      btn.classList.toggle('active',!on);
      btn.textContent=on?'Show English':'Hide English';
    });
  });

  /* ---- Autosave indicator ---- */
  const notesBox=document.getElementById('notesBox');
  const notesStatus=document.getElementById('notesStatus');
  let saveT; notesBox?.addEventListener('input',()=>{
    clearTimeout(saveT);
    saveT=setTimeout(()=>{
      notesStatus.classList.add('show');
      setTimeout(()=>notesStatus.classList.remove('show'),2000);
    },500);
  });

  /* ===== Poster Studio (detección automática mouse/touch) ===== */
  const drawCanvas=document.getElementById('drawCanvas');
  const mediaCanvas=document.getElementById('mediaCanvas');
  const notesCanvas=document.getElementById('notesCanvas');
  const drawCtx=drawCanvas.getContext('2d');
  const mediaCtx=mediaCanvas.getContext('2d');
  const notesCtx=notesCanvas.getContext('2d');

  // HiDPI
  [drawCanvas,mediaCanvas,notesCanvas].forEach(c=>{
    const ratio=Math.ceil(window.devicePixelRatio||1);
    const W=c.width,H=c.height;
    c.width=W*ratio; c.height=H*ratio;
    c.style.width=W+'px'; c.style.height=H+'px';
    c.getContext('2d').setTransform(ratio,0,0,ratio,0,0);
  });

  // Base blanca para dibujo
  drawCtx.fillStyle='white'; drawCtx.fillRect(0,0,drawCanvas.width,drawCanvas.height);

  // UI
  const colorPicker=document.getElementById('colorPicker');
  const brushSize=document.getElementById('brushSize');
  const sizeDisplay=document.getElementById('sizeDisplay');
  const penTool=document.getElementById('penTool');
  const eraserTool=document.getElementById('eraserTool');
  const imageUpload=document.getElementById('imageUpload');
  const addImgBtn=document.getElementById('addImgBtn');
  const addNoteBtn=document.getElementById('addNoteBtn');
  const noteText=document.getElementById('noteText');
  const noteSize=document.getElementById('noteSize');
  const noteColor=document.getElementById('noteColor');
  const noteHint=document.getElementById('noteHint');
  const undoBtn=document.getElementById('undoBtn');
  const clearAllBtn=document.getElementById('clearAllBtn');
  const saveBtn=document.getElementById('saveBtn');

  sizeDisplay.textContent=brushSize.value+'px';
  brushSize.addEventListener('input',()=>sizeDisplay.textContent=brushSize.value+'px');

  let currentTool='pen';
  const setTool=(t)=>{
    currentTool=t;
    [penTool,eraserTool].forEach(b=>b.classList.remove('active'));
    if(t==='pen') penTool.classList.add('active');
    if(t==='eraser') eraserTool.classList.add('active');
  };
  penTool.addEventListener('click',()=>setTool('pen'));
  eraserTool.addEventListener('click',()=>setTool('eraser'));
  setTool('pen');

  // Estado
  let images=[];     // {img,w,h,x,y}
  let notes=[];      // {x,y,w,h,text,fontPx,bg,border,urls:[]}
  let noteMode=false;

  // Historial unificado
  let history=[], historyIndex=-1;
  const cloneImages = a => a.map(o=>({img:o.img,w:o.w,h:o.h,x:o.x,y:o.y}));
  const cloneNotes  = a => JSON.parse(JSON.stringify(a));
  function snapshot(label=''){
    const drawSnap=drawCanvas.toDataURL();
    const mediaSnap=cloneImages(images);
    const notesSnap=cloneNotes(notes);
    historyIndex++;
    if(historyIndex<history.length) history.length=historyIndex;
    history.push({drawSnap,mediaSnap,notesSnap,label});
    if(history.length>50){history.shift();historyIndex--;}
  }
  function restore(st){
    const im=new Image();
    im.onload=()=>{
      drawCtx.globalCompositeOperation='source-over';
      drawCtx.clearRect(0,0,drawCanvas.width,drawCanvas.height);
      drawCtx.drawImage(im,0,0);
    };
    im.src=st.drawSnap;
    images=cloneImages(st.mediaSnap);
    notes=cloneNotes(st.notesSnap);
    renderMedia(); renderNotes();
  }
  function undoLast(){
    if(historyIndex>0){historyIndex--;restore(history[historyIndex]);}
  }
  undoBtn.addEventListener('click',undoLast);
  snapshot('init');

  // Utilidades
  function getPos(canvas, e){
    const r=canvas.getBoundingClientRect();
    const x=(e.clientX ?? e.touches?.[0]?.clientX ?? 0)-r.left;
    const y=(e.clientY ?? e.touches?.[0]?.clientY ?? 0)-r.top;
    return {x:Math.round(x), y:Math.round(y)};
  }
  function rr(ctx,x,y,w,h,r){ // rectángulo redondeado correcto
    ctx.beginPath();
    ctx.moveTo(x+r,y);
    ctx.arcTo(x+w,y,   x+w,y+h,r);
    ctx.arcTo(x+w,y+h, x,  y+h,r);
    ctx.arcTo(x,  y+h, x,  y,  r);
    ctx.arcTo(x,  y,   x+w,y,  r);
    ctx.closePath();
  }

    /* Render media (imágenes) */
  function renderMedia(){
    mediaCtx.clearRect(0,0,mediaCanvas.width,mediaCanvas.height);
    images.forEach(o=> mediaCtx.drawImage(o.img,o.x,o.y,o.w,o.h));
  }

  /* Render notas */
  const NOTE_COLORS=[
    {bg:'#fff8c5',border:'#facc15'},{bg:'#e0f2fe',border:'#38bdf8'},
    {bg:'#fde68a',border:'#f59e0b'},{bg:'#fee2e2',border:'#f87171'},
    {bg:'#e9d5ff',border:'#a78bfa'}
  ];
  const urlRegex=/\bhttps?:\/\/[^\s)]+/gi;
  function wrapLines(ctx,text,maxW){
    const words=text.split(/\s+/), lines=[]; let line='';
    for(const w of words){ const t=line?`${line} ${w}`:w; if(ctx.measureText(t).width>maxW){ if(line) lines.push(line); line=w; } else { line=t; } }
    if(line) lines.push(line); return lines;
  }
  function renderNotes(){
    notesCtx.clearRect(0,0,notesCanvas.width,notesCanvas.height);
    notes.forEach((n,i)=>{
      notesCtx.save();
      notesCtx.shadowColor='rgba(0,0,0,0.12)'; notesCtx.shadowBlur=6; notesCtx.shadowOffsetY=3;
      notesCtx.fillStyle=n.bg; notesCtx.strokeStyle=n.border; notesCtx.lineWidth=2; rr(notesCtx,n.x,n.y,n.w,n.h,10); notesCtx.fill(); notesCtx.stroke();
      // fold
      notesCtx.shadowColor='transparent'; notesCtx.fillStyle='rgba(0,0,0,0.06)';
      notesCtx.beginPath(); notesCtx.moveTo(n.x+n.w-22,n.y); notesCtx.lineTo(n.x+n.w,n.y); notesCtx.lineTo(n.x+n.w,n.y+22); notesCtx.closePath(); notesCtx.fill();
      // texto
      notesCtx.fillStyle='#111827'; notesCtx.font=`bold ${n.fontPx}px Inter, system-ui`;
      const pad=12, lines=wrapLines(notesCtx,n.text,n.w-pad*2), lh=Math.round(n.fontPx*1.35);
      lines.forEach((ln,j)=> notesCtx.fillText(ln,n.x+pad,n.y+pad+n.fontPx+j*lh));
      // link marker
      if(n.urls?.length){ notesCtx.fillStyle='#2563eb'; notesCtx.font=`bold ${Math.max(12,n.fontPx-2)}px Inter`; notesCtx.fillText('🔗',n.x+n.w-22,n.y+n.h-10); }
      notesCtx.restore();
    });
  }

  /* Colocar nota */
  function placeNoteAt(x,y,text,fontPx){
    const col=NOTE_COLORS[parseInt(noteColor.value,10)||0]||NOTE_COLORS[0];
    const wMin=160, wMax=260;
    notesCtx.font=`bold ${fontPx}px Inter`;
    const words=text.split(/\s+/); let line='', lines=[], w=0;
    for(const wd of words){ const t=line?line+' '+wd:wd; if(notesCtx.measureText(t).width>wMax-24){ lines.push(line); line=wd; } else { line=t; } }
    if(line) lines.push(line);
    w=Math.min(wMax,Math.max(wMin,Math.round(Math.max(...lines.map(l=>notesCtx.measureText(l).width))+24)));
    const h=Math.round(24+(fontPx*1.35)*lines.length+12);
    const urls=(text.match(urlRegex)||[]).map(u=>u.trim());
    notes.push({x:Math.max(8,x-Math.round(w/2)),y:Math.max(8,y-Math.round(h/2)),w,h,text,fontPx,bg:col.bg,border:col.border,urls});
  }

  /* Activar modo añadir nota (un solo click táctil/mouse) */
  addNoteBtn.addEventListener('click',()=>{
    if(!noteText.value.trim()){ noteText.focus(); noteText.placeholder='Type a tip… (required)'; return; }
    noteMode=true; noteHint.style.display='block';
  });

  /* Subir imagen */
  addImgBtn.addEventListener('click',()=> imageUpload.click());
  imageUpload.addEventListener('change',(e)=>{
    const f=e.target.files?.[0]; if(!f) return;
    const rd=new FileReader();
    rd.onload=ev=>{
      const im=new Image();
      im.onload=()=>{
        let w=im.width,h=im.height, maxW=360,maxH=360;
        if(w>maxW || h>maxH){ const r=Math.min(maxW/w,maxH/h); w=Math.round(w*r); h=Math.round(h*r); }
        const x=Math.round((mediaCanvas.width - w)/2), y=Math.round((mediaCanvas.height - h)/2);
        images.push({img:im,w,h,x,y});
        renderMedia(); snapshot('image-added');
      };
      im.src=ev.target.result;
    };
    rd.readAsDataURL(f); e.target.value='';
  });

  /* --- Detección automática con Pointer Events sobre notesCanvas --- */
  let mode='idle', last={x:0,y:0}, draggingImg=null, draggingNote=null;

  function hitNote(p){
    for(let i=notes.length-1;i>=0;i--){
      const n=notes[i];
      if(p.x>=n.x && p.x<=n.x+n.w && p.y>=n.y && p.y<=n.y+n.h) return i;
    }
    return -1;
  }
  function hitImage(p){
    for(let i=images.length-1;i>=0;i--){
      const o=images[i];
      if(p.x>=o.x && p.x<=o.x+o.w && p.y>=o.y && p.y<=o.y+o.h) return i;
    }
    return -1;
  }

  notesCanvas.addEventListener('pointerdown', (e)=>{
    const p=getPos(notesCanvas,e);
    notesCanvas.setPointerCapture(e.pointerId);

    // 1) ¿Estamos colocando una nota?
    if(noteMode){
      const text=noteText.value.trim(); const fontPx=parseInt(noteSize.value,10)||16;
      if(text){ placeNoteAt(p.x,p.y,text,fontPx); renderNotes(); snapshot('note-added'); }
      noteMode=false; noteHint.style.display='none';
      return;
    }

    // 2) ¿Tocaste una nota?
    const ni=hitNote(p);
    if(ni>-1){
      const picked=notes.splice(ni,1)[0]; notes.push(picked); // al frente
      draggingNote={index:notes.length-1,offsetX:p.x-picked.x,offsetY:p.y-picked.y};
      mode='dragNote'; return;
    }

    // 3) ¿Tocaste una imagen?
    const ii=hitImage(p);
    if(ii>-1){
      const picked=images.splice(ii,1)[0]; images.push(picked); // al frente
      draggingImg={index:images.length-1,offsetX:p.x-picked.x,offsetY:p.y-picked.y};
      mode='dragImg'; return;
    }

    // 4) Si no tocaste nada, es trazo de pluma/borrador
    mode='draw';
    last=p;
    drawCtx.lineCap='round'; drawCtx.lineJoin='round';
    drawCtx.lineWidth=parseInt(brushSize.value,10);
    if(currentTool==='pen'){ drawCtx.globalCompositeOperation='source-over'; drawCtx.strokeStyle=colorPicker.value; }
    else { drawCtx.globalCompositeOperation='destination-out'; }
  }, {passive:false});

  notesCanvas.addEventListener('pointermove', (e)=>{
    const p=getPos(notesCanvas,e);
    if(mode==='draw'){
      drawCtx.beginPath(); drawCtx.moveTo(last.x,last.y); drawCtx.lineTo(p.x,p.y); drawCtx.stroke(); last=p;
    } else if(mode==='dragImg' && draggingImg){
      const o=images[draggingImg.index]; o.x=p.x-draggingImg.offsetX; o.y=p.y-draggingImg.offsetY; renderMedia();
    } else if(mode==='dragNote' && draggingNote){
      const n=notes[draggingNote.index]; n.x=p.x-draggingNote.offsetX; n.y=p.y-draggingNote.offsetY; renderNotes();
    }
  }, {passive:false});

  function endPointer(e){
    if(mode==='draw') snapshot('draw-end');
    if(mode==='dragImg' && draggingImg) snapshot('image-drag-end');
    if(mode==='dragNote' && draggingNote) snapshot('note-drag-end');
    mode='idle'; draggingImg=null; draggingNote=null;
    try{ notesCanvas.releasePointerCapture(e.pointerId); }catch{}
  }
  notesCanvas.addEventListener('pointerup', endPointer);
  notesCanvas.addEventListener('pointercancel', endPointer);

  // Doble click para abrir links en notas
  notesCanvas.addEventListener('dblclick', (e)=>{
    const p=getPos(notesCanvas,e);
    const ni=hitNote(p);
    if(ni>-1){
      const n=notes[ni];
      if(!n.urls?.length) return;
      if(n.urls.length===1) window.open(n.urls[0],'_blank');
      else {
        const choice=prompt('Open which link?\n'+n.urls.map((u,j)=>`${j+1}. ${u}`).join('\n'));
        const idx=parseInt(choice,10);
        if(!isNaN(idx)&&idx>=1&&idx<=n.urls.length) window.open(n.urls[idx-1],'_blank');
      }
    }
  });

  /* Clear / Save */
  clearAllBtn.addEventListener('click',()=>{
    if(!confirm('Clear the entire poster (drawing, images, and notes)?')) return;
    drawCtx.globalCompositeOperation='source-over';
    drawCtx.clearRect(0,0,drawCanvas.width,drawCanvas.height);
    drawCtx.fillStyle='white'; drawCtx.fillRect(0,0,drawCanvas.width,drawCanvas.height);
    images=[]; notes=[]; renderMedia(); renderNotes(); snapshot('clear-all');
  });

  saveBtn.addEventListener('click',()=>{
    const merged=document.createElement('canvas');
    merged.width=drawCanvas.width; merged.height=drawCanvas.height;
    const mx=merged.getContext('2d');
    mx.fillStyle='white'; mx.fillRect(0,0,merged.width,merged.height);
    mx.drawImage(drawCanvas,0,0); mx.drawImage(mediaCanvas,0,0); mx.drawImage(notesCanvas,0,0);
    const a=document.createElement('a'); a.download='poster.png'; a.href=merged.toDataURL('image/png'); a.click();
  });

    // References toggle
  window.toggleReferences = function(){
    const content=document.getElementById('references-content');
    const icon=document.getElementById('toggle-icon');
    const open=content.classList.contains('show');
    content.classList.toggle('show'); icon.textContent=open?'▼':'▲';
  };

  console.log('✅ Poster Studio listo: detección automática mouse/touch, pluma/eraser OK, Undo global, imágenes y post-its arrastrables.');
}); // DOMContentLoaded
</script>
</body>
</html>


                          
